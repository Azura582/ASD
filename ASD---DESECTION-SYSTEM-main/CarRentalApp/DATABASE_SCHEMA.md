# Firebase Database Schema

## Collections Overview

The Car Rental App uses three main Firestore collections:
1. **users** - User profile information
2. **cars** - Car inventory and details
3. **bookings** - Rental bookings and history

---

## 1. Users Collection

**Collection Name:** `users`

**Document ID:** User's Firebase Auth UID

### Schema

```javascript
{
  uid: string,              // Firebase Auth UID
  email: string,            // User's email address
  username: string,         // Display name
  phoneNumber: string,      // Contact number (optional)
  createdAt: timestamp,     // Account creation date
  updatedAt: timestamp,     // Last profile update
  profileImage: string,     // URL to profile image (optional)
  preferences: {
    notifications: boolean,
    language: string
  }
}
```

### Example Document

```javascript
{
  uid: "abc123xyz",
  email: "john.doe@example.com",
  username: "John Doe",
  phoneNumber: "+1234567890",
  createdAt: "2024-01-15T10:30:00Z",
  updatedAt: "2024-01-15T10:30:00Z",
  profileImage: "",
  preferences: {
    notifications: true,
    language: "en"
  }
}
```

---

## 2. Cars Collection

**Collection Name:** `cars`

**Document ID:** Auto-generated by Firestore

### Schema

```javascript
{
  brand: string,            // Car manufacturer (e.g., "Toyota")
  model: string,            // Car model (e.g., "Camry")
  type: string,             // Car type (Sedan, SUV, Hatchback, Sports, Luxury, Electric)
  seatingCapacity: number,  // Number of seats (e.g., 5)
  fuelType: string,         // Fuel type (Petrol, Diesel, Electric, Hybrid)
  transmission: string,     // Transmission type (Automatic, Manual)
  pricePerDay: number,      // Rental price per day in USD
  available: boolean,       // Availability status
  features: array,          // List of features (e.g., ["AC", "GPS", "Bluetooth"])
  images: array,            // Array of image URLs
  year: number,             // Manufacturing year
  color: string,            // Car color
  licensePlate: string,     // License plate number
  mileage: number,          // Current mileage
  location: string,         // Current location/branch
  createdAt: timestamp,     // Date added to system
  updatedAt: timestamp      // Last update date
}
```

### Example Document

```javascript
{
  brand: "Toyota",
  model: "Camry",
  type: "Sedan",
  seatingCapacity: 5,
  fuelType: "Petrol",
  transmission: "Automatic",
  pricePerDay: 45,
  available: true,
  features: ["Air Conditioning", "Bluetooth", "GPS", "Airbags", "Power Windows"],
  images: [
    "https://example.com/images/camry1.jpg",
    "https://example.com/images/camry2.jpg"
  ],
  year: 2023,
  color: "Silver",
  licensePlate: "ABC-1234",
  mileage: 15000,
  location: "Downtown Branch",
  createdAt: "2024-01-01T00:00:00Z",
  updatedAt: "2024-01-15T10:00:00Z"
}
```

### Sample Cars to Add

```javascript
// Car 1 - Economy
{
  brand: "Hyundai",
  model: "i20",
  type: "Hatchback",
  seatingCapacity: 5,
  fuelType: "Petrol",
  transmission: "Manual",
  pricePerDay: 30,
  available: true,
  features: ["Air Conditioning", "Power Windows", "Music System"],
  images: [],
  year: 2023,
  color: "White",
  licensePlate: "XYZ-1001",
  mileage: 8000,
  location: "Airport Branch"
}

// Car 2 - SUV
{
  brand: "Honda",
  model: "CR-V",
  type: "SUV",
  seatingCapacity: 7,
  fuelType: "Diesel",
  transmission: "Automatic",
  pricePerDay: 65,
  available: true,
  features: ["Air Conditioning", "GPS", "Bluetooth", "Leather Seats", "Sunroof"],
  images: [],
  year: 2023,
  color: "Black",
  licensePlate: "SUV-2002",
  mileage: 12000,
  location: "Downtown Branch"
}

// Car 3 - Luxury
{
  brand: "Mercedes",
  model: "E-Class",
  type: "Luxury",
  seatingCapacity: 5,
  fuelType: "Diesel",
  transmission: "Automatic",
  pricePerDay: 150,
  available: true,
  features: ["Premium Sound System", "Leather Seats", "GPS", "Sunroof", "Parking Sensors"],
  images: [],
  year: 2024,
  color: "Silver",
  licensePlate: "LUX-3003",
  mileage: 5000,
  location: "Premium Branch"
}

// Car 4 - Electric
{
  brand: "Tesla",
  model: "Model 3",
  type: "Electric",
  seatingCapacity: 5,
  fuelType: "Electric",
  transmission: "Automatic",
  pricePerDay: 95,
  available: true,
  features: ["Autopilot", "Premium Sound", "Glass Roof", "Touchscreen Display"],
  images: [],
  year: 2024,
  color: "Blue",
  licensePlate: "EV-4004",
  mileage: 3000,
  location: "Tech Branch"
}
```

---

## 3. Bookings Collection

**Collection Name:** `bookings`

**Document ID:** Auto-generated by Firestore

### Schema

```javascript
{
  userId: string,           // Reference to user's UID
  carId: string,            // Reference to car document ID
  carDetails: {             // Snapshot of car info at booking time
    brand: string,
    model: string,
    type: string
  },
  tripDetails: {            // Trip information
    source: string,         // Pickup location
    destination: string,    // Drop-off location
    passengers: number,     // Number of passengers
    estimatedDistance: number,  // Distance in km
    estimatedDuration: string   // Travel time
  },
  startDate: string,        // Rental start date (YYYY-MM-DD)
  endDate: string,          // Rental end date (YYYY-MM-DD)
  days: number,             // Number of rental days
  totalPrice: number,       // Total rental cost
  notes: string,            // Additional notes (optional)
  status: string,           // Booking status (confirmed, ready, ongoing, completed, cancelled)
  createdAt: timestamp,     // Booking creation date
  updatedAt: timestamp,     // Last update date
  paymentStatus: string,    // Payment status (pending, paid, refunded)
  paymentMethod: string     // Payment method (optional)
}
```

### Booking Status Values

- **confirmed**: Booking is confirmed, waiting for pickup date
- **ready**: Car is ready for pickup
- **ongoing**: Rental is in progress
- **completed**: Rental completed successfully
- **cancelled**: Booking was cancelled

### Example Document

```javascript
{
  userId: "abc123xyz",
  carId: "car_doc_id_123",
  carDetails: {
    brand: "Toyota",
    model: "Camry",
    type: "Sedan"
  },
  tripDetails: {
    source: "New York",
    destination: "Boston",
    passengers: 3,
    estimatedDistance: 350,
    estimatedDuration: "4h 30m"
  },
  startDate: "2024-02-01",
  endDate: "2024-02-05",
  days: 4,
  totalPrice: 180,
  notes: "Need GPS navigation",
  status: "confirmed",
  createdAt: "2024-01-20T14:30:00Z",
  updatedAt: "2024-01-20T14:30:00Z",
  paymentStatus: "paid",
  paymentMethod: "credit_card"
}
```

---

## Indexes

### Recommended Composite Indexes

1. **Bookings by User and Date**
   - Collection: `bookings`
   - Fields: `userId` (Ascending), `createdAt` (Descending)

2. **Bookings by Car and Date**
   - Collection: `bookings`
   - Fields: `carId` (Ascending), `startDate` (Ascending)

3. **Available Cars**
   - Collection: `cars`
   - Fields: `available` (Ascending), `pricePerDay` (Ascending)

4. **Cars by Type and Price**
   - Collection: `cars`
   - Fields: `type` (Ascending), `pricePerDay` (Ascending)

---

## Security Considerations

1. **User Data**: Users can only read/write their own data
2. **Car Data**: All authenticated users can read, only admins can write
3. **Booking Data**: Users can only see their own bookings, admins can see all
4. **Validation**: Implement server-side validation using Cloud Functions
5. **Sensitive Data**: Never store payment card details in Firestore

---

## Data Migration

If you need to migrate existing data:

1. Export data from your current database
2. Transform data to match the schema above
3. Use Firebase Admin SDK to batch import
4. Verify data integrity after import

---

## Backup Strategy

1. Enable automatic backups in Firebase Console
2. Export critical data regularly
3. Test restore procedures
4. Keep backup of security rules

---

## Future Enhancements

Consider adding these collections as the app grows:

- **reviews** - User reviews and ratings
- **payments** - Payment transaction history
- **notifications** - User notifications
- **promotions** - Discount codes and offers
- **support** - Customer support tickets
